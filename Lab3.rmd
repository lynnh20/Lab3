DS 202 Lab 3

Names: Lynn Huang and Aisha Washington and also Prateek is here

Link to github repository: https://github.com/lynnh20/Lab3/ 

Reading in data and relevant packages
```{r}
library(ggplot2)
library(dplyr)
library(productplots)
data(happy)
happy = readRDS("data/HAPPY.rds")
dim(happy)
#Happy has 62,466 entries and 11 variables
```

Cleaning questions:

#1 Replace all instances of "IAP", "DK","NA" with NA.
```{r}
for (i in 1:62466)
{
  for (j in 1:11)
  {
    if (happy[i,j] == "IAP" || is.na(happy[i,j]))
    {
      happy[i,j] = NA
    }
    else if (happy[i,j] == "DK" || is.na(happy[i,j]))
    {
      happy[i,j] = NA
    }
    else if (happy[i,j] == "NA" || is.na(happy[i,j]))
    {
      happy[i,j] = NA
    }
    else
    {
      happy[i,j] = happy[i,j]
    }
  }
  
}
```
Cast any categorical variables to factor and replace "89 OR OLDER" in AGE to 89, then cast as numeric
```{r}
str(happy)
```
We cast the variables: HAPPY, SEX,MARITAL,FINRELA,HEALTH,DEGREE, PARTYID, and POLVIEWS as factor variables
```{r}
happy$AGE[happy$AGE == "89 OR OLDER"] = 89 
happy$AGE = as.numeric(happy$AGE)
happy$HAPPY = as.factor(happy$HAPPY)
happy$SEX = as.factor(happy$SEX)
happy$MARITAL = as.factor(happy$MARITAL)
happy$FINRELA = as.factor(happy$FINRELA)
happy$HEALTH = as.factor(happy$HEALTH)
happy$DEGREE = as.factor(happy$DEGREE)
happy$PARTYID = as.factor(happy$PARTYID)
happy$POLVIEWS = as.factor(happy$POLVIEWS)
```

#Bring all levels of factors to a sensible order

MARITAL is now arranged in ascending order by average age, all other variables are arranged in an ascending order that fits the category. 
```{r}
sub = happy %>% group_by(MARITAL) %>% summarise(mean = mean(AGE, na.rm = TRUE))
sub
```

```{r}
#HAPPY does not need to be reordered

#order marital by average age??
happy$MARITAL = factor(happy$MARITAL, levels = c("NEVER MARRIED","SEPARATED","MARRIED","DIVORCED","WIDOWED",NA))
#FINRELA
happy$FINRELA = factor(happy$FINRELA, levels=c("FAR BELOW AVERAGE", "BELOW AVERAGE","AVERAGE","ABOVE AVERAGE","FAR ABOVE AVERAGE", NA))
#HEALTH
happy$HEALTH = factor(happy$HEALTH, levels=c("POOR","FAIR","GOOD","EXCELLENT",NA))
#DEGREE
happy$DEGREE = factor(happy$DEGREE, levels=c("LT HIGH SCHOOL","HIGH SCHOOL", "JUNIOR COLLEGE","BACHELOR","GRADUATE",NA))
#PARTYID
happy$PARTYID = factor(happy$PARTYID, levels =c("STRONG DEMOCRAT","NOT STR DEMOCRAT","IND,NEAR DEM","INDEPENDENT","IND,NEAR REP","NOT STR REPUBLICAN","STRONG REPUBLICAN","OTHER PARTY",NA))
#POLVIEWS
happy$POLVIEWS = factor(happy$POLVIEWS,levels =c("EXTREMELY LIBERAL","LIBERAL","SLIGHTLY LIBERAL","MODERATE","SLIGHTLY CONSERVATIVE","CONSERVATIVE","EXTREMELY CONSERVATIVE",NA))
```
#Saving final dataset
```{r}
Happy.Clean = saveRDS(happy, "happy.RDS")
```

Exploration question

# Indivdual Portions
# Prateek's Investigation
Prateek looked at the correlation marital status and happiness, which is a super basic question but he's a little lost because he's been missing class :C (please don't a mark down Lynn and Aisha if I did something wrong here)
But there's this mosaic plot which looks pretty cool. Mosaic plots allow you to find relationships by providing an overview of data and 
bin size, so you can look at the area of the tiles to see what the relationships are. From there, you can tell that married men and women have the biggest bins in the pretty happy and very happy categories, while they are about even in the not happy category. There seems to be a less of an impact for the never married and separated demographics. 
```{r}
library(ggplot2)
library(ggmosaic)

ggplot(data = happy) +
  geom_mosaic(aes(x = product(HAPPY, SEX), fill=MARITAL, weight=1)) + coord_flip()
```

# Aisha's Ivestigation  
How are Health, Marital Status, and Happiness related?
```{r}
library(ggplot2) #AGE and HEALTH

ggplot(happy, aes(x = HEALTH)) +
  geom_bar(aes(fill = MARITAL)) +
  facet_wrap(~HAPPY) +
  coord_flip()
```

Overall we can see that most people are "Pretty Happy" and less people are "Not Too Happy". In the Happy categories, people are mainly "Married" (or "Never Married") with most people in "Good" or "Excellent" health.  Meanwhile the "Not Too Happy" category doesn't appear to have any trends (though there are possibly more people in "Good" or "Fair"  health than in the other categories).

# Lynn's investigation
```{r}

library(ggplot2)
na.omit(happy) %>% ggplot(aes(x = DEGREE,  fill = HAPPY)) +  geom_bar(position = "fill") + theme(axis.text.x = element_text(angle = 45)) + facet_wrap(~PARTYID) + coord_flip()
```

Lynn chose to examine the relationship between level of education (DEGREE), political party affiliation (PARTYID), and happiness (HAPPY). These bar charts are arranged by DEGREE, faceted by PARTYID, and then proportionally filled by level of happiness. Among parties and edcuation levels, we see similar trends. The people most likely to rate themselves not too happy are those with those who have not completed a high school education, while those least likely to rate themselves as not too happy are those who have a graduate level education, with the exception of the independent and other party categories. It also appears that those who identify with the Republican party are more likely to rate themselves very happy than those who identify with the Democratic party. 
